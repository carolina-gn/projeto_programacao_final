{% extends "rank_estatisticas.html" %}
{% block content %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Link para o CSS customizado desta página -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estatisticas.css') }}">
  
  <!-- Chart.js para gerar o gráfico -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Logotipo da aplicação -->
  <section class="box1"> <img src="{{ url_for('static', filename='images/quizzify_logo_principal.png') }}" style="display: block; margin: 0 auto"; alt="Logo Quiz" width="200"></section>

  <div class="container mt-4">

    <!-- Título da seção de progresso -->
    <h3 class="text-center">Progresso por Categoria</h3>

    <!-- Container com fundo e bordas para a seção de barras de progresso -->
    <div class="progress-wrapper p-3">

      <!-- Loop por categorias, criando uma barra de progresso para cada -->
      {% for categoria in ['Conhecimento_geral', 'Entretenimento', 'Desporto', 'Ciência'] %}
        <div class="mb-3">
          <strong>{{ categoria }}</strong>
          <div class="progress" style="height: 20px; background-color: white;">
            
            <!-- Barra de progresso com cor conforme a categoria -->
            <div class="progress-bar 
                        {% if categoria == 'Conhecimento_geral' %}bg-success
                        {% elif categoria == 'Entretenimento' %}bg-info
                        {% elif categoria == 'Desporto' %}bg-warning text-dark
                        {% elif categoria == 'Ciência' %}bg-danger
                        {% endif %}"
                style="width: {{ progresso.get(categoria, 0) }}%;">
              {{ progresso.get(categoria, 0) }}%
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <hr>

    <!-- Título da seção de gráfico -->
    <h3 class="text-center">Histórico de Pontuações</h3>
    
    <!-- Se houver histórico, mostra o gráfico, senão exibe mensagem -->
    {% if historico %}
      <canvas id="userProgressChart" width="400" height="200"></canvas>
    {% else %}
      <p class="text-center text-muted">Sem dados de pontuação recentes.</p>
    {% endif %}
  </div>

  <!-- Script para gerar o gráfico se existir histórico -->
  {% if historico %}
  <script>

    // Lista de datas do histórico
    const labels = {{ historico | map(attribute='data') | list | tojson }};
   
   // Lista de pontuações associadas às datas
    const data = {{ historico | map(attribute='pontuacao') | list | tojson }};

    // Configuração do gráfico
    const ctx = document.getElementById('userProgressChart').getContext('2d');
    const userProgressChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Pontuação (%)',
                data: data,
                fill: false,
                borderColor: 'rgba(75, 192, 192, 1)',
                tension: 0.3
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
  </script>
  {% endif %}
{% endblock %}
